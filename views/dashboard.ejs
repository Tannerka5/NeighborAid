<%- include('partials/header') %>

<!-- Page Header -->
<div class="page-header">
  <div>
    <h1>Welcome, <%= user.firstName %>!</h1>
    <p class="page-subtitle">Here's your emergency preparedness overview</p>
  </div>
</div>

<!-- Dashboard Stats Grid -->
<div class="dashboard-grid">
  <!-- Household Status Card -->
  <div class="card">
    <div class="card-icon households" style="background-color: #e8f5e9; color: #43a047;">üè†</div>
    <div class="card-title">Household Status</div>
    <div class="card-value">
      <span class="readiness-indicator <%= household ? 'readiness-' + household.readiness_level : 'readiness-low' %>"></span>
      <% if (household) { %>
        <span style="font-size: 16px; margin-left: 10px; text-transform: capitalize;">
          <%= household.readiness_level || 'Low' %>
        </span>
      <% } else { %>
        <span style="font-size: 16px; margin-left: 10px;">Not Set</span>
      <% } %>
    </div>
    <a href="/household/edit" class="card-action">View Details ‚Üí</a>
  </div>

  <!-- Resources Card -->
  <div class="card card-highlight">
    <div class="card-icon resources" style="background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%); color: white; box-shadow: 0 4px 10px rgba(255, 107, 157, 0.3);">üì¶</div>
    <div class="card-title">Your Resources</div>
    <div class="card-value" style="flex-direction: column; align-items: flex-start;">
      <div style="display: flex; align-items: baseline; gap: 8px;">
        <span style="font-size: 28px; color: #c44569; font-weight: 700;">You Have</span>
      </div>
      <div style="display: flex; align-items: baseline; gap: 8px; margin-top: 5px;">
        <span style="font-size: 40px; color: #1e3c72; font-weight: 800;"><%= resources ? resources.length : 0 %></span>
        <span style="font-size: 20px; color: #666; font-weight: 600;">Resource<%= (resources && resources.length !== 1) ? 's' : '' %></span>
      </div>
    </div>
    <a href="/resources" class="card-action" style="color: #c44569;">Manage Resources ‚Üí</a>
  </div>

  <!-- Neighborhood Map Card -->
  <div class="card card-highlight">
    <div class="card-icon neighborhoods" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; box-shadow: 0 4px 10px rgba(79, 172, 254, 0.3);">üó∫Ô∏è</div>
    <div class="card-title">Neighborhood Resources</div>
    <div class="card-value" style="flex-direction: column; align-items: flex-start;">
      <div style="display: flex; align-items: baseline; gap: 8px;">
        <span style="font-size: 28px; color: #1976d2; font-weight: 700;">Your Neighborhood Has</span>
      </div>
      <div style="display: flex; align-items: baseline; gap: 8px; margin-top: 5px;">
        <span style="font-size: 40px; color: #1e3c72; font-weight: 800;"><%= neighborhoodResourceCount || 0 %></span>
        <span style="font-size: 20px; color: #666; font-weight: 600;">Resource<%= (neighborhoodResourceCount && neighborhoodResourceCount !== 1) ? 's' : '' %></span>
      </div>
    </div>
    <a href="/directory/map" class="card-action" style="color: #1976d2;">View Map ‚Üí</a>
  </div>
</div>

<!-- Household Profile Section -->
<% if (household) { %>
  <div class="household-profile-section">
    <h3 class="section-title">
      <span class="readiness-indicator <%= 'readiness-' + (household.readiness_level || 'low') %>"></span>
      Household Profile
    </h3>
    
    <div class="profile-grid">
      <div class="profile-item">
        <div class="profile-label">Address</div>
        <div class="profile-value"><%= household.address || 'Not Set' %></div>
      </div>
      <div class="profile-item">
        <div class="profile-label">Phone</div>
        <div class="profile-value"><%= household.phone_number || 'Not Set' %></div>
      </div>
      <div class="profile-item">
        <div class="profile-label">Neighborhood Code</div>
        <div class="profile-value"><%= household.neighborhood_code || 'Not Set' %></div>
      </div>
      <div class="profile-item">
        <div class="profile-label">Readiness Level</div>
        <div class="profile-value" style="text-transform: capitalize;">
          <%= household.readiness_level || 'Low' %>
        </div>
      </div>
    </div>

    <% if (household.notes) { %>
      <div style="margin-top: 20px; padding: 15px; background-color: #f5f7fa; border-radius: 8px; border-left: 4px solid #2a5298;">
        <div class="profile-label">Additional Notes</div>
        <p style="color: #666; margin-top: 8px;"><%= household.notes %></p>
      </div>
    <% } %>

    <div style="margin-top: 20px; text-align: right;">
      <a href="/household/edit" class="btn btn-outline">Edit Household Profile</a>
    </div>
  </div>
<% } else { %>
  <!-- Household Setup Call-to-Action -->
  <div class="empty-state">
    <div class="empty-state-icon">üè†</div>
    <h3>Complete Your Household Profile</h3>
    <p>Set up your household information to connect with your community and access emergency preparedness features.</p>
    <a href="/household/edit" class="btn btn-primary btn-lg">Set Up Household Profile</a>
  </div>
<% } %>

<!-- Resources Section -->
<div class="household-profile-section" style="margin-top: 30px;">
  <h3 class="section-title">Your Resources</h3>
  
  <% if (resources && resources.length > 0) { %>
    <div class="resources-list">
      <% resources.slice(0, 5).forEach(function(resource) { %>
        <div class="resource-item">
          <div class="resource-info">
            <div class="resource-icon">
              <% if (resource.resourceType.category === 'supplies') { %>
                üì¶
              <% } else if (resource.resourceType.category === 'equipment') { %>
                ‚öôÔ∏è
              <% } else if (resource.resourceType.category === 'skills') { %>
                üéì
              <% } else if (resource.resourceType.category === 'space') { %>
                üè†
              <% } else { %>
                üì¶
              <% } %>
            </div>
            <div class="resource-details">
              <h4><%= resource.resourceType.name %></h4>
              <p><%= resource.description || 'No description provided' %></p>
            </div>
          </div>
          <div class="resource-quantity">Qty: <%= resource.quantity %></div>
        </div>
      <% }); %>
      
      <% if (resources.length > 5) { %>
        <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
          <a href="/resources" class="card-action" style="font-size: 15px;">
            View All <%= resources.length %> Resources ‚Üí
          </a>
        </div>
      <% } else { %>
        <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
          <a href="/resources" class="card-action" style="font-size: 15px;">
            Manage Resources ‚Üí
          </a>
        </div>
      <% } %>
    </div>
  <% } else { %>
    <div style="text-align: center; padding: 40px; background-color: #f5f7fa; border-radius: 8px;">
      <div style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;">üì¶</div>
      <p style="color: #999; margin-bottom: 20px;">
        No resources added yet. Start building your emergency preparedness kit.
      </p>
      <a href="/resources/add" class="btn btn-primary">Add Your First Resource</a>
    </div>
  <% } %>
</div>

<!-- Quick Actions Section -->
<div class="household-profile-section" style="margin-top: 30px;">
  <h3 class="section-title">Quick Actions</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
    <a href="/members" class="btn btn-outline" style="justify-content: flex-start; width: 100%;">
      <span style="margin-right: 10px;">üë•</span>
      Neighborhood Members
    </a>
    <a href="/directory/map" class="btn btn-outline" style="justify-content: flex-start; width: 100%;">
      <span style="margin-right: 10px;">üó∫Ô∏è</span>
      View Map
    </a>
    <a href="/profile" class="btn btn-outline" style="justify-content: flex-start; width: 100%;">
      <span style="margin-right: 10px;">üë§</span>
      Profile Settings
    </a>
  </div>
</div>

<!-- Emergency Preparedness Tips -->
<div class="household-profile-section" style="margin-top: 30px; background: linear-gradient(135deg, #e8f0f8 0%, #ffffff 100%); border: 2px solid #2a5298;">
  <h3 class="section-title">üí° Emergency Preparedness Tips</h3>
  <ul style="list-style: none; padding: 0; margin: 0;">
    <li style="padding: 10px 0; display: flex; align-items: flex-start; gap: 10px; border-bottom: 1px solid #e0e0e0;">
      <span style="color: #2a5298; font-weight: bold; font-size: 16px;">1.</span>
      <span style="color: #666;">Keep at least 3 days of non-perishable food and water for each household member</span>
    </li>
    <li style="padding: 10px 0; display: flex; align-items: flex-start; gap: 10px; border-bottom: 1px solid #e0e0e0;">
      <span style="color: #2a5298; font-weight: bold; font-size: 16px;">2.</span>
      <span style="color: #666;">Maintain a first aid kit and check expiration dates regularly</span>
    </li>
    <li style="padding: 10px 0; display: flex; align-items: flex-start; gap: 10px; border-bottom: 1px solid #e0e0e0;">
      <span style="color: #2a5298; font-weight: bold; font-size: 16px;">3.</span>
      <span style="color: #666;">Create a family emergency communication plan</span>
    </li>
    <li style="padding: 10px 0; display: flex; align-items: flex-start; gap: 10px;">
      <span style="color: #2a5298; font-weight: bold; font-size: 16px;">4.</span>
      <span style="color: #666;">Connect with neighbors and share resources through NeighborAid</span>
    </li>
  </ul>
</div>

<!-- Add styles from original dashboard -->
<style>
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .card-highlight {
    border: 2px solid transparent;
    background: linear-gradient(white, white) padding-box,
                linear-gradient(135deg, rgba(42, 82, 152, 0.1), rgba(42, 82, 152, 0.05)) border-box;
  }

  .card-highlight:hover {
    border-color: rgba(42, 82, 152, 0.2);
  }

  .card-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    margin-bottom: 15px;
    transition: transform 0.3s ease;
  }

  .card:hover .card-icon {
    transform: scale(1.1) rotate(5deg);
  }

  .card-title {
    font-size: 14px;
    color: #999;
    text-transform: uppercase;
    font-weight: 600;
    margin-bottom: 15px;
    letter-spacing: 0.5px;
  }

  .card-value {
    font-size: 32px;
    color: #1e3c72;
    font-weight: 700;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
  }

  .card-action {
    color: #2a5298;
    text-decoration: none;
    font-size: 14px;
    font-weight: 600;
    transition: gap 0.2s ease;
    display: inline-block;
  }

  .card-action:hover {
    text-decoration: underline;
  }

  .household-profile-section {
    background: white;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
  }

  .section-title {
    font-size: 18px;
    color: #1e3c72;
    font-weight: 700;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .readiness-indicator {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: inline-block;
  }

  .readiness-low {
    background-color: #f44336;
  }

  .readiness-medium {
    background-color: #ff9800;
  }

  .readiness-high {
    background-color: #4caf50;
  }

  .profile-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
  }

  .profile-item {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    background-color: #fafafa;
  }

  .profile-label {
    font-size: 12px;
    color: #999;
    text-transform: uppercase;
    font-weight: 600;
    margin-bottom: 8px;
  }

  .profile-value {
    font-size: 16px;
    color: #333;
    font-weight: 600;
  }

  .resources-list {
    margin-top: 20px;
  }

  .resource-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    margin-bottom: 10px;
    background-color: #fafafa;
    transition: all 0.2s;
  }

  .resource-item:hover {
    background-color: #f5f7fa;
    border-color: #2a5298;
  }

  .resource-info {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .resource-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    background-color: #e8f5e9;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }

  .resource-details h4 {
    color: #333;
    font-size: 14px;
    margin-bottom: 4px;
    font-weight: 600;
  }

  .resource-details p {
    color: #999;
    font-size: 12px;
    margin: 0;
  }

  .resource-quantity {
    background-color: #e8f5e9;
    color: #43a047;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
  }

  @media (max-width: 768px) {
    .dashboard-grid {
      grid-template-columns: 1fr;
    }

    .profile-grid {
      grid-template-columns: 1fr;
    }

    .resource-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }

    .resource-quantity {
      align-self: flex-start;
    }

    .card-value {
      font-size: 28px;
    }
  }
</style>

<%- include('partials/footer') %>
