<%- include('../partials/header') %>

<style>
  .form-card {
    background: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    max-width: 800px;
    margin: 0 auto;
  }

  .form-section {
    margin-bottom: 30px;
  }

  .form-section-title {
    font-size: 16px;
    color: #1e3c72;
    font-weight: 700;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e0e0e0;
  }

  .form-group {
    margin-bottom: 20px;
  }

  label {
    display: block;
    margin-bottom: 8px;
    color: #333;
    font-weight: 600;
    font-size: 14px;
  }

  input[type="text"],
  input[type="number"],
  textarea,
  select {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    font-size: 14px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    transition: border-color 0.3s;
  }

  input:focus,
  textarea:focus,
  select:focus {
    outline: none;
    border-color: #2a5298;
  }

  textarea {
    resize: vertical;
    min-height: 100px;
  }

  .checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .checkbox-group input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  .checkbox-group label {
    margin: 0;
    cursor: pointer;
    font-weight: normal;
  }

  .resource-category-info {
    background-color: #e3f2fd;
    border-left: 4px solid #2a5298;
    padding: 12px 15px;
    border-radius: 4px;
    font-size: 12px;
    color: #1565c0;
    margin-bottom: 15px;
  }

  .quantity-helper {
    background-color: #f5f5f5;
    padding: 10px 12px;
    border-radius: 4px;
    font-size: 12px;
    color: #666;
    margin-top: 6px;
  }

  .resource-preview {
    background-color: #fafafa;
    border: 2px dashed #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
  }

  .preview-title {
    font-size: 14px;
    color: #999;
    text-transform: uppercase;
    font-weight: 600;
    margin-bottom: 15px;
  }

  .preview-card {
    background: white;
    border-left: 4px solid #2a5298;
    border-radius: 6px;
    padding: 15px;
  }

  .preview-resource-name {
    font-size: 16px;
    color: #1e3c72;
    font-weight: 700;
    margin-bottom: 8px;
  }

  .preview-resource-desc {
    color: #666;
    font-size: 13px;
    margin-bottom: 8px;
  }

  .preview-category {
    display: inline-block;
    background-color: #e3f2fd;
    color: #1976d2;
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    margin-bottom: 8px;
    text-transform: uppercase;
  }

  .button-group {
    display: flex;
    gap: 15px;
    margin-top: 30px;
  }

  @media (max-width: 600px) {
    .button-group {
      flex-direction: column;
    }

    .form-card {
      padding: 20px;
    }
  }
</style>

<div class="page-header">
  <h1><%= isEdit ? 'Edit' : 'Add' %> Resource</h1>
  <p class="page-subtitle">Manage your emergency resources</p>
</div>

<div class="form-card">
  <% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-error"><%= error %></div>
  <% } %>

  <form method="POST" action="<%= isEdit ? '/resources/update/' + resource.id : '/resources/add' %>">
    <div class="form-section">
      <h3 class="form-section-title">Resource Details</h3>

      <div class="form-group">
        <label for="resourceType">Resource Type *</label>
        <select 
          id="resourceType" 
          name="resourceTypeId" 
          required 
          onchange="updatePreview()" 
          data-resource-types='<%= JSON.stringify(resourceTypes) %>'
        >
          <option value="">Select a resource type...</option>
          <% resourceTypes.forEach(function(type) { %>
            <option 
              value="<%= type.id %>" 
              <%= isEdit && resource.resourceTypeId === type.id ? 'selected' : '' %>
            >
              <%= type.name %>
            </option>
          <% }); %>
        </select>

        <% if (typeof selectedType !== 'undefined' && selectedType) { %>
          <div class="resource-category-info">
            <strong>Category:</strong> <%= selectedType.category %> - <%= selectedType.description %>
          </div>
        <% } %>
      </div>

      <div class="form-group">
        <label for="quantity">Quantity *</label>
        <input 
          type="number" 
          id="quantity" 
          name="quantity" 
          min="1" 
          required 
          placeholder="Enter quantity" 
          value="<%= isEdit ? resource.quantity : '' %>" 
          onchange="updatePreview()"
        />
        <div class="quantity-helper">
          Enter the number of units you have available (e.g., 2 generators, 10 gallons of water)
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea 
          id="description" 
          name="description" 
          placeholder="Provide additional details about this resource (e.g., condition, specifications, contact person for this resource)" 
          onchange="updatePreview()"
        ><%= isEdit ? resource.description : '' %></textarea>
      </div>
    </div>

    <div class="form-section">
      <h3 class="form-section-title">Availability</h3>

      <div class="checkbox-group">
        <input 
          type="checkbox" 
          id="isAvailable" 
          name="isAvailable" 
          <%= isEdit && !resource.isAvailable ? '' : 'checked' %> 
          onchange="updatePreview()"
        />
        <label for="isAvailable">This resource is currently available</label>
      </div>
    </div>

    <div class="resource-preview">
      <div class="preview-title">ðŸ“¦ Resource Preview</div>
      <div class="preview-card">
        <div class="preview-category" id="previewCategory">Resource Category</div>
        <div class="preview-resource-name" id="previewName">Resource Name</div>
        <div class="preview-resource-desc" id="previewDesc">Your description will appear here</div>
        <div style="margin-top: 10px;">
          <span style="font-size: 12px; color: #666;">
            Quantity: <strong id="previewQty">0</strong> | 
            Status: <strong id="previewStatus">Available</strong>
          </span>
        </div>
      </div>
    </div>

    <div class="button-group">
      <button type="submit" class="btn btn-primary">
        <%= isEdit ? 'Update' : 'Add' %> Resource
      </button>
      <a href="/resources" class="btn btn-secondary">Cancel</a>
    </div>
  </form>
</div>

<script>
  function updatePreview() {
    const resourceTypeSelect = document.getElementById('resourceType');
    const quantityInput = document.getElementById('quantity');
    const descriptionInput = document.getElementById('description');
    const isAvailableInput = document.getElementById('isAvailable');

    const selectedOption = resourceTypeSelect.options[resourceTypeSelect.selectedIndex];
    const resourceName = selectedOption.text || 'Resource Name';

    // Get resource types from data attribute
    const resourceTypes = JSON.parse(resourceTypeSelect.dataset.resourceTypes || '[]');
    const selectedIndex = resourceTypeSelect.selectedIndex;
    const selectedType = resourceTypes[selectedIndex - 1]; // -1 for placeholder option

    document.getElementById('previewName').textContent = resourceName;
    document.getElementById('previewQty').textContent = quantityInput.value || '0';
    document.getElementById('previewDesc').textContent = descriptionInput.value || 'Add a description to help your neighbors understand this resource';
    document.getElementById('previewStatus').textContent = isAvailableInput.checked ? 'Available' : 'Unavailable';

    if (selectedType) {
      document.getElementById('previewCategory').textContent = (selectedType.category || 'RESOURCE CATEGORY').toUpperCase();
    } else {
      document.getElementById('previewCategory').textContent = 'RESOURCE CATEGORY';
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    updatePreview();
  });
</script>

<%- include('../partials/footer') %>
