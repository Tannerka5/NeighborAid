<%- include('partials/header') %>

<style>
  .details-card {
    background: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    margin-bottom: 30px;
  }

  .section-title {
    font-size: 18px;
    color: #1e3c72;
    font-weight: 700;
    margin-bottom: 20px;
  }

  .profile-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
  }

  .profile-item {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    background-color: #fafafa;
  }

  .profile-label {
    font-size: 12px;
    color: #999;
    text-transform: uppercase;
    font-weight: 600;
    margin-bottom: 8px;
  }

  .profile-value {
    font-size: 16px;
    color: #333;
    font-weight: 600;
  }

  .edit-input {
    width: 100%;
    padding: 10px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #ccc;
    display: none;
  }

  .view {
    display: block;
  }

  .btn-row {
    display: flex;
    gap: 15px;
    margin-top: 25px;
  }

  @media (max-width: 768px) {
    .profile-grid {
      grid-template-columns: 1fr;
    }

    .btn-row {
      flex-direction: column;
    }

    .btn-row button,
    .btn-row a {
      width: 100%;
      text-align: center;
    }
  }
</style>

<div class="page-header">
  <h1>My Profile</h1>
  <p class="page-subtitle">Manage your account information</p>
</div>

<% if (typeof error !== 'undefined' && error) { %>
  <div class="alert alert-error"><%= error %></div>
<% } %>

<% if (typeof success !== 'undefined' && success) { %>
  <div class="alert alert-success"><%= success %></div>
<% } %>

<div class="details-card">
  <h3 class="section-title">Account Information</h3>

  <form id="profileForm" action="/profile" method="POST">
    <div class="profile-grid">
      <div class="profile-item">
        <div class="profile-label">First Name</div>
        <div class="profile-value view"><%= user.first_name %></div>
        <input class="edit-input" name="first_name" value="<%= user.first_name %>" required />
      </div>

      <div class="profile-item">
        <div class="profile-label">Last Name</div>
        <div class="profile-value view"><%= user.last_name %></div>
        <input class="edit-input" name="last_name" value="<%= user.last_name %>" required />
      </div>

      <div class="profile-item">
        <div class="profile-label">Email</div>
        <div class="profile-value view"><%= user.email %></div>
        <input class="edit-input" type="email" name="email" value="<%= user.email %>" required />
      </div>

      <div class="profile-item">
        <div class="profile-label">Role</div>
        <div class="profile-value"><%= user.role || 'member' %></div>
      </div>
    </div>

    <!-- Password Change Section -->
    <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid #e0e0e0;">
      <h3 class="section-title">Change Password (Optional)</h3>
      <p style="color: #666; font-size: 14px; margin-bottom: 20px;">Leave blank to keep your current password</p>

      <div class="profile-grid">
        <div class="profile-item">
          <div class="profile-label">Current Password</div>
          <input class="edit-input" type="password" name="current_password" placeholder="Enter current password" style="display: block;" />
        </div>

        <div class="profile-item">
          <div class="profile-label">New Password</div>
          <input class="edit-input" type="password" name="new_password" placeholder="Enter new password" style="display: block;" />
        </div>

        <div class="profile-item">
          <div class="profile-label">Confirm New Password</div>
          <input class="edit-input" type="password" name="confirm_password" placeholder="Confirm new password" style="display: block;" />
        </div>
      </div>
    </div>

    <div class="btn-row">
      <button type="button" id="editBtn" class="btn btn-primary">Edit Profile</button>
      <button type="submit" id="saveBtn" class="btn btn-primary" style="display:none;">Save Changes</button>
      <button type="button" id="cancelBtn" class="btn btn-secondary" style="display:none;">Cancel</button>
      <a href="/dashboard" class="btn btn-secondary" id="backBtn">Back to Dashboard</a>
    </div>
  </form>
</div>

<script>
  const editBtn = document.getElementById('editBtn');
  const saveBtn = document.getElementById('saveBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const backBtn = document.getElementById('backBtn');
  const views = document.querySelectorAll('.view');
  const inputs = document.querySelectorAll('.edit-input');
  const originalValues = {};

  // Store original values
  inputs.forEach(input => {
    originalValues[input.name] = input.value;
  });

  editBtn.addEventListener('click', () => {
    views.forEach(v => v.style.display = 'none');
    inputs.forEach(i => i.style.display = 'block');
    editBtn.style.display = 'none';
    saveBtn.style.display = 'inline-block';
    cancelBtn.style.display = 'inline-block';
    backBtn.style.display = 'none';
  });

  cancelBtn.addEventListener('click', () => {
    // Restore original values
    inputs.forEach(input => {
      input.value = originalValues[input.name];
    });

    views.forEach(v => v.style.display = 'block');
    inputs.forEach(i => i.style.display = 'none');
    editBtn.style.display = 'inline-block';
    saveBtn.style.display = 'none';
    cancelBtn.style.display = 'none';
    backBtn.style.display = 'inline-block';
  });

  // Form will submit normally via POST to /profile
</script>

<%- include('partials/footer') %>
